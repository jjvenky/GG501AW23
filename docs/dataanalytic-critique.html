<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GG501 - 3&nbsp; Data/Analytic Critique</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./data-to-decisions.html" rel="next">
<link href="./dataanalytic-visualization.html" rel="prev">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data/Analytic Critique</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GG501</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">GG501 Spatial Knowledge Mobilization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataanalytic-visualization.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data/Analytic Visualization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataanalytic-critique.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data/Analytic Critique</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-to-decisions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data to Decisions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignments.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Assignments</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#spatial-modelling-example---adapted-workshop-example" id="toc-spatial-modelling-example---adapted-workshop-example" class="nav-link active" data-scroll-target="#spatial-modelling-example---adapted-workshop-example"><span class="toc-section-number">3.1</span>  Spatial modelling example - adapted workshop example</a>
  <ul class="collapse">
  <li><a href="#resources-this-week" id="toc-resources-this-week" class="nav-link" data-scroll-target="#resources-this-week"><span class="toc-section-number">3.1.1</span>  Resources this week</a></li>
  </ul></li>
  <li><a href="#parameterizationvalidation-iii" id="toc-parameterizationvalidation-iii" class="nav-link" data-scroll-target="#parameterizationvalidation-iii"><span class="toc-section-number">3.2</span>  Parameterization/Validation I/II</a></li>
  <li><a href="#modelling-socio-technical-critique" id="toc-modelling-socio-technical-critique" class="nav-link" data-scroll-target="#modelling-socio-technical-critique"><span class="toc-section-number">3.3</span>  Modelling: Socio-Technical Critique</a>
  <ul class="collapse">
  <li><a href="#resources-this-week-1" id="toc-resources-this-week-1" class="nav-link" data-scroll-target="#resources-this-week-1"><span class="toc-section-number">3.3.1</span>  Resources this week</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data/Analytic Critique</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The use of modelling is increasing as more data is produced and codified into machine-readable forms. From classical statistical models to modern machine learning frameworks, models make inferences about real world processes that rely on implicit and explicit assumptions and decisions. In order to work effectively with the outptus of models we must be able to explore these underlying factors and how they influence what models produce. As machine learning models in particular are encoded into complex data-analytic workflows, we need to develop skills for interrograting and deconstructing models, their paramaters and uncertainties, and their strengths and weaknesses. The next two weeks will focus on developing some skills for working with model output and exploring their fit in the context of R-based data science workflow, however similar tools exist and can be used in other languages and/or modelling environments.</p>
<section id="spatial-modelling-example---adapted-workshop-example" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="spatial-modelling-example---adapted-workshop-example"><span class="header-section-number">3.1</span> Spatial modelling example - adapted workshop example</h2>
<p>The <a href="https://www.fs.usda.gov/rm/ogden/research/Rworkshop/SampleData.shtml">data for this workshop</a> demo exists as multiple files and folders, so we have zipped them up and posted them to this github repo. Note that we have to use the <code>raw</code> link to get access to the actual data file not the page that shows the file, with that link we can follow the workflow we have used before to download, unzip and remove the zip file. Note that his zip file is large (~17 mb) so we probably only want to download it once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download.file("https://github.com/jjvenky/gg501/blob/main/data/workshop_data.zip?raw=true", </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># destfile = "workshop_data.zip" , mode='wb')</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># unzip("workshop_data.zip", exdir = ".")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># file.remove("workshop_data.zip")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Read in and examine the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">6</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>plt <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"workshop_data/SampleData_Basics/plt.csv"</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">col_types =</span> <span class="fu">list</span>(<span class="fu">col_character</span>(), <span class="fu">col_integer</span>(), </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">col_integer</span>(), <span class="fu">col_integer</span>(), <span class="fu">col_integer</span>(), <span class="fu">col_double</span>(), </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">col_double</span>(), <span class="fu">col_integer</span>(), <span class="fu">col_double</span>(), <span class="fu">col_double</span>(), </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">col_character</span>(), <span class="fu">col_integer</span>()))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"workshop_data/SampleData_Basics/tree.csv"</span>, <span class="at">col_types =</span> <span class="fu">list</span>(<span class="fu">col_character</span>()))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>ref <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"workshop_data/SampleData_Basics/ref_SPCD.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 15 Columns: 4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): SPNM, GRPNM
dbl (2): SPCD, GRPCD

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">left_join</span>(tree, ref, <span class="at">by=</span><span class="st">"SPCD"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>spfreq <span class="ot">&lt;-</span> tree <span class="sc">%&gt;%</span> <span class="fu">select</span>(PLT_CN, SPNM)  <span class="sc">%&gt;%</span> <span class="fu">table</span>() <span class="sc">%&gt;%</span> <span class="fu">as.data.frame.matrix</span>()  <span class="sc">%&gt;%</span> <span class="fu">select</span>(aspen) <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="st">"PLT_CN"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#reset any counts greater than 1 to 1 --binary response</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>spfreq<span class="sc">$</span>aspen[spfreq<span class="sc">$</span>aspen<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>plt2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(plt, spfreq, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"CN"</span> <span class="ot">=</span> <span class="st">"PLT_CN"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have created the <code>plt2</code> dataset at the plot level which contains plots where aspen is present or absent. We will keep working with the instructions from the workshop slides and modernize some of the workflow:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/response.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Slide from workshop.</figcaption><p></p>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Forest Inventory data (Model response)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Now, let's compile total carbon by plot and append to plot table.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># First, create a table of counts by plot.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plt2 <span class="ot">&lt;-</span> tree <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PLT_CN) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">CARBON_AG =</span> <span class="fu">sum</span>(CARBON_AG)) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CARBON_KG =</span> <span class="fu">round</span>(CARBON_AG <span class="sc">*</span> <span class="fl">0.453592</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(plt2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"PLT_CN"</span> <span class="ot">=</span> <span class="st">"CN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CARBON_KG =</span> <span class="fu">replace</span>(CARBON_KG, <span class="fu">is.na</span>(CARBON_KG), <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">aspen =</span> <span class="fu">replace</span>(aspen, <span class="fu">is.na</span>(aspen), <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CARBON_AG =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can carry on with some of the spatial data processing to build the variables for modelling, a very common workflow:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)  <span class="co"># GDAL operations for spatial data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Please note that rgdal will be retired during 2023,
plan transition to sf/stars/terra functions using GDAL and PROJ
at your earliest convenience.
See https://r-spatial.org/r/2022/04/12/evolution.html and https://github.com/r-spatial/evolution
rgdal: version: 1.6-3, (SVN revision 1187)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 3.4.1, released 2021/12/27
Path to GDAL shared files: /usr/share/gdal
GDAL binary built with GEOS: TRUE 
Loaded PROJ runtime: Rel. 8.2.1, January 1st, 2022, [PJ_VERSION: 821]
Path to PROJ shared files: /home/jason/.local/share/proj:/usr/share/proj
PROJ CDN enabled: FALSE
Linking to sp version:1.5-1
To mute warnings of possible GDAL/OSR exportToProj4() degradation,
use options("rgdal_show_exportToProj4_warnings"="none") before loading sp or rgdal.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster) <span class="co"># Analyzing gridded spatial data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'raster'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)  <span class="co"># Recursive partitioning and regression trees</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)<span class="co"># For book (An R Companion to Applied Regression)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'car'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)   <span class="co"># Generates Random Forest models</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>randomForest 4.7-1.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Type rfNews() to see new features/changes/bug fixes.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'randomForest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PresenceAbsence)<span class="co"># Evaluates results of presence-absence models</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ModelMap)   <span class="co"># Generates and applies Random Forest models</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># You may need to installed ModelMaps via remotes::install_github("cran/ModelMap")</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to extract data from spatial layers, so let's convert the plot table to a SpatialPoints object in R.</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="do">## We know the projection information, so we can add it to the SpatialPoints object. </span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>prj4str <span class="ot">&lt;-</span> <span class="st">"+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs"</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>ptshp <span class="ot">&lt;-</span> <span class="fu">SpatialPointsDataFrame</span>(plt[,<span class="fu">c</span>(<span class="st">"LON"</span>,<span class="st">"LAT"</span>)], plt,  <span class="at">proj4string =</span> <span class="fu">CRS</span>(prj4str))</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Display the points</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ptshp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Predictor variables:</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Landsat Thematic Mapper, band 5   30-m spectral data, band 5, resampled to 90 m</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Landsat Thematic Mapper, NDVI 30-m spectral data, NDVI, resampled to 90 m</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Classified forest/nonforest map   250-m classified MODIS, resampled to 90 m</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Elevation 30-m DEM, resampled to 90 m</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Slope 90-m DEM – derived in a following slides</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aspect  </span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Set file names</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>b5fn <span class="ot">&lt;-</span> <span class="st">"workshop_data/SampleData_Spatial/uintaN_TMb5.img"</span>  <span class="co"># Landsat TM–Band5</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>ndvifn <span class="ot">&lt;-</span> <span class="st">"workshop_data/SampleData_Spatial/uintaN_TMndvi.img"</span>  <span class="co"># Landsat TM–NDVI</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>fnffn <span class="ot">&lt;-</span> <span class="st">"workshop_data/SampleData_Spatial/uintaN_fnfrcl.img"</span>   <span class="co"># Forest type map (reclassed)</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>elevfn <span class="ot">&lt;-</span> <span class="st">"workshop_data/SampleData_Spatial/uintaN_elevm.img"</span>   <span class="co"># Elevation (meters)</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Reclass raster layer to 2 categories</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>fnf <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">"workshop_data/SampleData_Spatial/uintaN_fnf.img"</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Create raster look-up table</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>fromvect <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>tovect <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>rclmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(fromvect, tovect), <span class="dv">4</span>, <span class="dv">2</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Generate raster and save to SpatialData folder</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>fnfrcl <span class="ot">&lt;-</span> <span class="fu">reclassify</span>(<span class="at">x=</span>fnf, rclmat, <span class="at">datatype=</span><span class="st">"INT2U"</span>, <span class="at">filename=</span><span class="st">"workshop_data/SampleData_Spatial/uintaN_fnfrcl.img"</span>, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Check rasters</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>rastfnlst <span class="ot">&lt;-</span> <span class="fu">c</span>(b5fn, ndvifn, fnffn, elevfn)</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>rastfnlst</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "workshop_data/SampleData_Spatial/uintaN_TMb5.img"  
[2] "workshop_data/SampleData_Spatial/uintaN_TMndvi.img"
[3] "workshop_data/SampleData_Spatial/uintaN_fnfrcl.img"
[4] "workshop_data/SampleData_Spatial/uintaN_elevm.img" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(rastfnlst, raster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`workshop_data/SampleData_Spatial/uintaN_TMb5.img`
class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : uintaN_TMb5.img 
names      : Layer_1 
values     : 1, 255  (min, max)


$`workshop_data/SampleData_Spatial/uintaN_TMndvi.img`
class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : uintaN_TMndvi.img 
names      : Layer_1 
values     : 0, 193  (min, max)


$`workshop_data/SampleData_Spatial/uintaN_fnfrcl.img`
class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : uintaN_fnfrcl.img 
names      : layer 
values     : 1, 2  (min, max)


$`workshop_data/SampleData_Spatial/uintaN_elevm.img`
class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : uintaN_elevm.img 
names      : Layer_1 
values     : 1847, 4114  (min, max)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Now, let's generate slope from DEM. Save it to your workshop_data/SampleData_Spatial folder.</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(terrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Help on topic 'terrain' was found in the following packages:

  Package               Library
  raster                /home/jason/R/x86_64-pc-linux-gnu-library/4.1
  terra                 /home/jason/R/x86_64-pc-linux-gnu-library/4.1


Using the first match ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(writeRaster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Help on topic 'writeRaster' was found in the following packages:

  Package               Library
  raster                /home/jason/R/x86_64-pc-linux-gnu-library/4.1
  terra                 /home/jason/R/x86_64-pc-linux-gnu-library/4.1


Using the first match ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>slpfn <span class="ot">&lt;-</span> <span class="st">"workshop_data/SampleData_Spatial/uintaN_slp.img"</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> <span class="fu">terrain</span>(<span class="fu">raster</span>(elevfn), <span class="at">opt=</span><span class="fu">c</span>(<span class="st">'slope'</span>), <span class="at">unit=</span><span class="st">'degrees'</span>,<span class="at">filename=</span>slpfn, <span class="at">datatype=</span><span class="st">'INT1U'</span>, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="do">####************* this may take some time ****************  </span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(slope, <span class="at">col=</span><span class="fu">topo.colors</span>(<span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">####************* this may take some time ****************</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Check rasters</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>rastfnlst <span class="ot">&lt;-</span> <span class="fu">c</span>(b5fn, ndvifn, fnffn, elevfn, slpfn)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>rastfnlst</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "workshop_data/SampleData_Spatial/uintaN_TMb5.img"  
[2] "workshop_data/SampleData_Spatial/uintaN_TMndvi.img"
[3] "workshop_data/SampleData_Spatial/uintaN_fnfrcl.img"
[4] "workshop_data/SampleData_Spatial/uintaN_elevm.img" 
[5] "workshop_data/SampleData_Spatial/uintaN_slp.img"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(rastfnlst, raster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`workshop_data/SampleData_Spatial/uintaN_TMb5.img`
class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : uintaN_TMb5.img 
names      : Layer_1 
values     : 1, 255  (min, max)


$`workshop_data/SampleData_Spatial/uintaN_TMndvi.img`
class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : uintaN_TMndvi.img 
names      : Layer_1 
values     : 0, 193  (min, max)


$`workshop_data/SampleData_Spatial/uintaN_fnfrcl.img`
class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : uintaN_fnfrcl.img 
names      : layer 
values     : 1, 2  (min, max)


$`workshop_data/SampleData_Spatial/uintaN_elevm.img`
class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : uintaN_elevm.img 
names      : Layer_1 
values     : 1847, 4114  (min, max)


$`workshop_data/SampleData_Spatial/uintaN_slp.img`
class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : uintaN_slp.img 
names      : layer 
values     : 0, 77  (min, max)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">## We can also generate aspect from DEM. Save it to your workshop_data/SampleData_Spatial folder.</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(terrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Help on topic 'terrain' was found in the following packages:

  Package               Library
  raster                /home/jason/R/x86_64-pc-linux-gnu-library/4.1
  terra                 /home/jason/R/x86_64-pc-linux-gnu-library/4.1


Using the first match ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">## This is an intermediate step, so we are not going to save it.</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>aspectr <span class="ot">&lt;-</span> <span class="fu">terrain</span>(<span class="fu">raster</span>(elevfn), <span class="at">opt=</span><span class="fu">c</span>(<span class="st">'aspect'</span>), <span class="at">unit=</span><span class="st">'radians'</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>aspectr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : memory
names      : aspect 
values     : 0, 6.283185  (min, max)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Make sure to use radians, not degrees</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="do">####************* this may take some time ****************</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(aspectr, <span class="at">col=</span><span class="fu">terrain.colors</span>(<span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Aspect is a circular variable. There are a couple ways to deal with this:</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. Convert the values to a categorical variable (ex. North, South, West, East)</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="do">## We derived aspect in radians. First convert radians to degrees.</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>aspectd <span class="ot">&lt;-</span> <span class="fu">round</span>(aspectr <span class="sc">*</span> <span class="dv">180</span><span class="sc">/</span>pi)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>aspectd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : memory
names      : layer 
values     : 0, 360  (min, max)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Now, create a look-up table of reclass values.</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(reclassify)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>frommat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>, <span class="dv">45</span>,<span class="dv">135</span>, <span class="dv">135</span>,<span class="dv">225</span>, <span class="dv">225</span>,<span class="dv">315</span>, <span class="dv">315</span>,<span class="dv">361</span>), <span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>frommat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    0  225
[2,]   45  225
[3,]   45  315
[4,]  135  315
[5,]  135  361</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>frommat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>, <span class="dv">45</span>,<span class="dv">135</span>, <span class="dv">135</span>,<span class="dv">225</span>, <span class="dv">225</span>,<span class="dv">315</span>, <span class="dv">315</span>,<span class="dv">361</span>), <span class="dv">5</span>, <span class="dv">2</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>frommat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    0   45
[2,]   45  135
[3,]  135  225
[4,]  225  315
[5,]  315  361</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>tovect <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>rclmat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(frommat, tovect)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>rclmat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             tovect
[1,]   0  45      1
[2,]  45 135      2
[3,] 135 225      3
[4,] 225 315      4
[5,] 315 361      1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Reclassify raster to new values.</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>aspcl <span class="ot">&lt;-</span> <span class="fu">reclassify</span>(<span class="at">x=</span>aspectd, rclmat, <span class="at">include.lowest=</span><span class="cn">TRUE</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>aspcl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : memory
names      : layer 
values     : 1, 4  (min, max)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(aspcl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>bks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">sort</span>(<span class="fu">unique</span>(aspcl))) <span class="co"># Break points</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"dark green"</span>, <span class="st">"wheat"</span>, <span class="st">"yellow"</span>, <span class="st">"blue"</span>)  <span class="co"># Colors</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"East"</span>, <span class="st">"South"</span>, <span class="st">"West"</span>) <span class="co"># Labels</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>lab.pts <span class="ot">&lt;-</span> bks[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">-</span><span class="fu">diff</span>(bks)<span class="sc">/</span><span class="dv">2</span>  <span class="co"># Label position</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="do">####************* this may take some time ****************</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(aspcl, <span class="at">col=</span>cols, <span class="at">axis.args=</span><span class="fu">list</span>(<span class="at">at=</span>lab.pts, <span class="at">labels=</span>labs), <span class="at">breaks=</span>bks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. Convert to a linear variable (ex. solar radiation index; Roberts and Cooper 1989)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>aspval <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">cos</span>(aspectr<span class="sc">+</span><span class="dv">30</span>))<span class="sc">/</span><span class="dv">2</span>   <span class="do">## Roberts and Cooper 1989</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>aspval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : memory
names      : layer 
values     : 7.793766e-13, 1  (min, max)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(aspval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's multiply by 100 and round so it will be an integer (less memory)</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>aspval <span class="ot">&lt;-</span> <span class="fu">round</span>(aspval <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>aspval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class      : RasterLayer 
dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
resolution : 30, 30  (x, y)
extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
source     : memory
names      : layer 
values     : 0, 100  (min, max)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(aspval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save this layer to file</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>aspvalfn <span class="ot">&lt;-</span> <span class="st">"workshop_data/SampleData_Spatial/uintaN_aspval.img"</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(aspval, <span class="at">filename=</span>aspvalfn, <span class="at">datatype=</span><span class="st">'INT1U'</span>, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add aspval to rastfnlst</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>rastfnlst <span class="ot">&lt;-</span> <span class="fu">c</span>(rastfnlst, aspvalfn)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Converts aspect into solar radiation equivalents, with a correction of 30 degrees to reflect ## the relative heat of the atmosphere at the time the peak radiation is received. </span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Max value is 1.0, occurring at 30 degrees aspect; min value is 0, at 210 degrees aspect. </span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Roberts, D.W., and S. V. Cooper. 1989. Concepts and techniques in vegetation mapping. In Land classifications based on vegetation: applications for resource management. D. Ferguson, P. Morgan, and F. D. Johnson, editors. USDA Forest Service General Technical Report INT-257, Ogden, Utah, USA.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Predictor Data Extraction</strong></p>
<p><img src="img/extraction.png" class="img-fluid"></p>
<p>One of the most common uses of GIS and spatial processing functions in <code>R</code> is to build spatial variables which are then used for modelling. Here we have some data at specific coordinates where field plots were located, and we have several raster layers where we have environmental covariates. We want to extract values of raster layers at the locations of the point data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="do">## We need to check the projections of the rasters. If the projections are different,</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="do">## reproject the points to the projection of the rasters, it is much faster.</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="do">## We will use the plt2 table with LON/LAT coordinates and the response data attached.</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(plt2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  PLT_CN  CARBO…¹ INVYR STATECD COUNT…²  PLOT   LON   LAT NBRCND CRCOV…³ CCLIV…⁴
  &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 119396…    1840  2006      49       9 80275 -110.  40.9      1      50      50
2 119401…    5069  2006      49      13 80402 -110.  40.6      1      43      55
3 119401…    1416  2006      49      13 80936 -111.  40.6      1      28      28
4 119402…    1336  2006      49      13 82102 -110.  40.7      1      39      39
5 119404…    6512  2006      49      13 83586 -111.  40.6      1      38      38
6 119405…    3295  2006      49      13 83925 -110.  40.6      1      27      27
# … with 3 more variables: FORNONSAMP &lt;chr&gt;, ELEVM &lt;int&gt;, aspen &lt;dbl&gt;, and
#   abbreviated variable names ¹​CARBON_KG, ²​COUNTYCD, ³​CRCOVPLT, ⁴​CCLIVEPLT</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="do">## We know the LON/LAT coordinates have the following projection:</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>prj4str <span class="ot">&lt;-</span> <span class="st">"+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs"</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check projections of each raster..  </span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(rastfnlst, <span class="cf">function</span>(x){ <span class="fu">projection</span>(<span class="fu">raster</span>(x)) })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   workshop_data/SampleData_Spatial/uintaN_TMb5.img 
"+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs" 
 workshop_data/SampleData_Spatial/uintaN_TMndvi.img 
"+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs" 
 workshop_data/SampleData_Spatial/uintaN_fnfrcl.img 
"+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs" 
  workshop_data/SampleData_Spatial/uintaN_elevm.img 
"+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs" 
    workshop_data/SampleData_Spatial/uintaN_slp.img 
"+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs" 
 workshop_data/SampleData_Spatial/uintaN_aspval.img 
"+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Reproject SpatialPoints object to match raster projections. </span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(project)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Help on topic 'project' was found in the following packages:

  Package               Library
  rgdal                 /home/jason/R/x86_64-pc-linux-gnu-library/4.1
  terra                 /home/jason/R/x86_64-pc-linux-gnu-library/4.1


Using the first match ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>rast.prj <span class="ot">&lt;-</span> <span class="fu">projection</span>(<span class="fu">raster</span>(rastfnlst[<span class="dv">1</span>]))</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">&lt;-</span> <span class="fu">cbind</span>(plt<span class="sc">$</span>LON, plt<span class="sc">$</span>LAT)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>xyprj <span class="ot">&lt;-</span> <span class="fu">project</span>(xy, <span class="at">proj=</span>rast.prj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: PROJ support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract values (raster package)</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(extract)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Help on topic 'extract' was found in the following packages:

  Package               Library
  raster                /home/jason/R/x86_64-pc-linux-gnu-library/4.1
  magrittr              /home/jason/R/x86_64-pc-linux-gnu-library/4.1
  terra                 /home/jason/R/x86_64-pc-linux-gnu-library/4.1


Using the first match ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's extract values from 1 layer.</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">extract</span>(<span class="fu">raster</span>(elevfn), xyprj)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2873 2575 2444 3474 2715 3360</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let's create a function to extract, so we can extract from all the rasters at the same time. </span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>extract.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rast, xy){ <span class="fu">extract</span>(<span class="fu">raster</span>(rast), xy) }</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, apply this function to the vector list of raster file names.</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>rastext <span class="ot">&lt;-</span> <span class="fu">sapply</span>(rastfnlst, extract.fun, xyprj)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the output and check the class. </span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rastext)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     workshop_data/SampleData_Spatial/uintaN_TMb5.img
[1,]                                               72
[2,]                                               93
[3,]                                              129
[4,]                                               98
[5,]                                               98
[6,]                                               60
     workshop_data/SampleData_Spatial/uintaN_TMndvi.img
[1,]                                                167
[2,]                                                148
[3,]                                                129
[4,]                                                143
[5,]                                                149
[6,]                                                165
     workshop_data/SampleData_Spatial/uintaN_fnfrcl.img
[1,]                                                  1
[2,]                                                  1
[3,]                                                  2
[4,]                                                  2
[5,]                                                  1
[6,]                                                  1
     workshop_data/SampleData_Spatial/uintaN_elevm.img
[1,]                                              2873
[2,]                                              2575
[3,]                                              2444
[4,]                                              3474
[5,]                                              2715
[6,]                                              3360
     workshop_data/SampleData_Spatial/uintaN_slp.img
[1,]                                               6
[2,]                                               6
[3,]                                              28
[4,]                                              18
[5,]                                              19
[6,]                                               7
     workshop_data/SampleData_Spatial/uintaN_aspval.img
[1,]                                                 42
[2,]                                                  0
[3,]                                                 99
[4,]                                                 42
[5,]                                                  1
[6,]                                                 42</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(rastext)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "matrix" "array" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract values (raster package) cont..  change names</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's make the column names shorter. </span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rastext)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "workshop_data/SampleData_Spatial/uintaN_TMb5.img"  
[2] "workshop_data/SampleData_Spatial/uintaN_TMndvi.img"
[3] "workshop_data/SampleData_Spatial/uintaN_fnfrcl.img"
[4] "workshop_data/SampleData_Spatial/uintaN_elevm.img" 
[5] "workshop_data/SampleData_Spatial/uintaN_slp.img"   
[6] "workshop_data/SampleData_Spatial/uintaN_aspval.img"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the rastfnlst vector of file names to get new column names.</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First, get the base name of each raster, without the extension.</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>cnames <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">basename</span>(rastfnlst), <span class="st">".img"</span>))</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>cnames</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "uintaN_TMb5"   "uintaN_TMndvi" "uintaN_fnfrcl" "uintaN_elevm" 
[5] "uintaN_slp"    "uintaN_aspval"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We could stop here, but let's make the names even shorter and remove</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 'uintaN_' from each name.</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>cnames2 <span class="ot">&lt;-</span> <span class="fu">substr</span>(cnames, <span class="dv">8</span>, <span class="fu">nchar</span>(cnames))</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>cnames2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "TMb5"   "TMndvi" "fnfrcl" "elevm"  "slp"    "aspval"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, add names to matrix. Because the output is a matrix, we will use colnames.</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rastext) <span class="ot">&lt;-</span> cnames2</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rastext)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     TMb5 TMndvi fnfrcl elevm slp aspval
[1,]   72    167      1  2873   6     42
[2,]   93    148      1  2575   6      0
[3,]  129    129      2  2444  28     99
[4,]   98    143      2  3474  18     42
[5,]   98    149      1  2715  19      1
[6,]   60    165      1  3360   7     42</code></pre>
</div>
</div>
<p><img src="img/generation.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let's append this matrix to the plot table with the response data (plt2).</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(plt2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  PLT_CN  CARBO…¹ INVYR STATECD COUNT…²  PLOT   LON   LAT NBRCND CRCOV…³ CCLIV…⁴
  &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 119396…    1840  2006      49       9 80275 -110.  40.9      1      50      50
2 119401…    5069  2006      49      13 80402 -110.  40.6      1      43      55
3 119401…    1416  2006      49      13 80936 -111.  40.6      1      28      28
4 119402…    1336  2006      49      13 82102 -110.  40.7      1      39      39
5 119404…    6512  2006      49      13 83586 -111.  40.6      1      38      38
6 119405…    3295  2006      49      13 83925 -110.  40.6      1      27      27
# … with 3 more variables: FORNONSAMP &lt;chr&gt;, ELEVM &lt;int&gt;, aspen &lt;dbl&gt;, and
#   abbreviated variable names ¹​CARBON_KG, ²​COUNTYCD, ³​CRCOVPLT, ⁴​CCLIVEPLT</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We just want the response variables, so let's extract these columns along with the unique identifier of the table (CN, aspen, CARBON_KG).</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>modeldat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(plt2[,<span class="fu">c</span>(<span class="st">"PLT_CN"</span>, <span class="st">"aspen"</span>, <span class="st">"CARBON_KG"</span>)], rastext)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(modeldat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          PLT_CN aspen CARBON_KG TMb5 TMndvi fnfrcl elevm slp aspval
1 11939665010690     0      1840   72    167      1  2873   6     42
2 11940123010690     0      5069   93    148      1  2575   6      0
3 11940180010690     0      1416  129    129      2  2444  28     99
4 11940287010690     0      1336   98    143      2  3474  18     42
5 11940414010690     0      6512   98    149      1  2715  19      1
6 11940500010690     0      3295   60    165      1  3360   7     42</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if this is a data frame</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.data.frame</span>(modeldat) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(modeldat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 288   9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's also append the projected xy coordinates for overlaying with raster layers.</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>modeldat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(xyprj, modeldat)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(modeldat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1       2         PLT_CN aspen CARBON_KG TMb5 TMndvi fnfrcl elevm slp
1 589393.4 4530338 11939665010690     0      1840   72    167      1  2873   6
2 599757.3 4525551 11940123010690     0      5069   93    148      1  2575   6
3 594947.7 4535131 11940180010690     0      1416  129    129      2  2444  28
4 550308.7 4505418 11940287010690     0      1336   98    143      2  3474  18
5 548315.9 4487922 11940414010690     0      6512   98    149      1  2715  19
6 559454.7 4510667 11940500010690     0      3295   60    165      1  3360   7
  aspval
1     42
2      0
3     99
4     42
5      1
6     42</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(modeldat)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"X"</span>, <span class="st">"Y"</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(modeldat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         X       Y         PLT_CN aspen CARBON_KG TMb5 TMndvi fnfrcl elevm slp
1 589393.4 4530338 11939665010690     0      1840   72    167      1  2873   6
2 599757.3 4525551 11940123010690     0      5069   93    148      1  2575   6
3 594947.7 4535131 11940180010690     0      1416  129    129      2  2444  28
4 550308.7 4505418 11940287010690     0      1336   98    143      2  3474  18
5 548315.9 4487922 11940414010690     0      6512   98    149      1  2715  19
6 559454.7 4510667 11940500010690     0      3295   60    165      1  3360   7
  aspval
1     42
2      0
3     99
4     42
5      1
6     42</code></pre>
</div>
</div>
<p>Now follow along with the <strong>Data Exploration</strong> section of the workshop slides. Think about what you would change and what you might leave the same regarding coding style and workflow.</p>
<p>Now we will continue on with the <strong>Modelling Generation</strong> section of the workshop slides, following the code below.</p>
<p><img src="img/generation.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Classification tree</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>asp.tree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(aspen <span class="sc">~</span> TMb5 <span class="sc">+</span> TMndvi <span class="sc">+</span> fnfrcl <span class="sc">+</span> elevm <span class="sc">+</span> slp <span class="sc">+</span> aspval,<span class="at">data=</span>modeldat, <span class="at">method=</span><span class="st">"class"</span>)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(asp.tree)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(asp.tree, <span class="at">cex=</span><span class="fl">0.75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Regression tree</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>carb.tree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(CARBON_KG <span class="sc">~</span> TMb5 <span class="sc">+</span> TMndvi <span class="sc">+</span> fnfrcl <span class="sc">+</span> elevm <span class="sc">+</span> slp <span class="sc">+</span> aspval,   <span class="at">data=</span>modeldat)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(carb.tree)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(carb.tree, <span class="at">cex=</span><span class="fl">0.75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Now, let's use the randomForests package – Classification tree</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(randomForest)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's try with ASPEN binary, categorical response (presence/absence)</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">66</span>)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>asp.mod <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="fu">factor</span>(aspen) <span class="sc">~</span> TMb5 <span class="sc">+</span> TMndvi <span class="sc">+</span> fnfrcl <span class="sc">+</span> elevm <span class="sc">+</span> slp <span class="sc">+</span> aspval,  <span class="at">data=</span>modeldat, <span class="at">importance =</span> <span class="cn">TRUE</span>, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Default parameters:</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ntree = 500   # Number of trees</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a><span class="co"># mtry = sqrt(p)# Number of predictors (p) randomly sampled at each node</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a><span class="co"># nodesize = 1  # Minimum size of terminal nodes</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="co"># replace = TRUE# Bootstrap samples are selected with replacement   </span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Look at results</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>asp.mod</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(formula = factor(aspen) ~ TMb5 + TMndvi + fnfrcl +      elevm + slp + aspval, data = modeldat, importance = TRUE,      na.action = na.exclude) 
               Type of random forest: classification
                     Number of trees: 500
No. of variables tried at each split: 2

        OOB estimate of  error rate: 25%
Confusion matrix:
    0  1 class.error
0 212 11  0.04932735
1  60  1  0.98360656</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(asp.mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Length Class   Mode     
call               5   -none-  call     
type               1   -none-  character
predicted        284   factor  numeric  
err.rate        1500   -none-  numeric  
confusion          6   -none-  numeric  
votes            568   matrix  numeric  
oob.times        284   -none-  numeric  
classes            2   -none-  character
importance        24   -none-  numeric  
importanceSD      18   -none-  numeric  
localImportance    0   -none-  NULL     
proximity          0   -none-  NULL     
ntree              1   -none-  numeric  
mtry               1   -none-  numeric  
forest            14   -none-  list     
y                284   factor  numeric  
test               0   -none-  NULL     
inbag              0   -none-  NULL     
terms              3   terms   call     
na.action          4   exclude numeric  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>err <span class="ot">&lt;-</span> asp.mod<span class="sc">$</span>err.rate <span class="co"># Out-Of-Bag (OOB) error rate (of i-th element)</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(err)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           OOB         0         1
[1,] 0.2884615 0.2093023 0.6666667
[2,] 0.3657143 0.2928571 0.6571429
[3,] 0.3443396 0.2690058 0.6585366
[4,] 0.3319672 0.2164948 0.7800000
[5,] 0.3307393 0.1881188 0.8545455
[6,] 0.3159851 0.1753555 0.8275862</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(err)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             OOB          0         1
[495,] 0.2500000 0.04932735 0.9836066
[496,] 0.2500000 0.04932735 0.9836066
[497,] 0.2500000 0.04932735 0.9836066
[498,] 0.2500000 0.04932735 0.9836066
[499,] 0.2535211 0.05381166 0.9836066
[500,] 0.2500000 0.04932735 0.9836066</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> asp.mod<span class="sc">$</span>confusion<span class="co"># Confusion matrix</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    0  1 class.error
0 212 11  0.04932735
1  60  1  0.98360656</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Classification tree - Output</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the number of trees by the error rate</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>, err[,<span class="st">"OOB"</span>], <span class="at">xlab=</span><span class="st">"Number of trees"</span>, <span class="at">ylab=</span><span class="st">"Error rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: how many trees needed to stabilize prediction</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the percent correctly classified from confusion (error) matrix</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    0  1 class.error
0 212 11  0.04932735
1  60  1  0.98360656</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>pcc <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(mat[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]))<span class="sc">/</span><span class="fu">sum</span>(mat) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>pcc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 74.72821</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>pcc <span class="ot">&lt;-</span> <span class="fu">round</span>(pcc, <span class="dv">2</span>)<span class="do">## Round to nearest 2 decimals</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>pcc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 74.73</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PresenceAbsence)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pcc</span>(mat[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">st.dev=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   PCC     PCC.sd
1 0.75 0.02573993</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Kappa</span>(mat[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">st.dev=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Kappa  Kappa.sd
0 -0.04650197 0.0302359</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="do">## The Kappa statistic summarizes all the available information in the confusion matrix.</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Kappa measures the proportion of correctly classified units after accounting for the probability of chance agreement.</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Now, let's use the randomForests package – regression tree</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Now, let's try with the continuous, CARBON_KG response</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">66</span>)</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>carb.mod <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(CARBON_KG <span class="sc">~</span> TMb5 <span class="sc">+</span> TMndvi <span class="sc">+</span> elevm <span class="sc">+</span> slp <span class="sc">+</span> aspval,  <span class="at">data=</span>modeldat, <span class="at">importance =</span> <span class="cn">TRUE</span>, <span class="at">na.action=</span>na.exclude)</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Default parameters:</span></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ntree = 500   # Number of trees</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a><span class="co"># mtry = p/3# Number of predictors (p) randomly sampled at each node</span></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a><span class="co"># nodesize = 5  # Minimum size of terminal nodes</span></span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a><span class="co"># replace = TRUE# Bootstrap samples are selected with replacement   </span></span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Look at results</span></span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a>carb.mod</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(formula = CARBON_KG ~ TMb5 + TMndvi + elevm + slp +      aspval, data = modeldat, importance = TRUE, na.action = na.exclude) 
               Type of random forest: regression
                     Number of trees: 500
No. of variables tried at each split: 1

          Mean of squared residuals: 4130918
                    % Var explained: -7.24</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(carb.mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Length Class   Mode     
call              5    -none-  call     
type              1    -none-  character
predicted       284    -none-  numeric  
mse             500    -none-  numeric  
rsq             500    -none-  numeric  
oob.times       284    -none-  numeric  
importance       10    -none-  numeric  
importanceSD      5    -none-  numeric  
localImportance   0    -none-  NULL     
proximity         0    -none-  NULL     
ntree             1    -none-  numeric  
mtry              1    -none-  numeric  
forest           11    -none-  list     
coefs             0    -none-  NULL     
y               284    -none-  numeric  
test              0    -none-  NULL     
inbag             0    -none-  NULL     
terms             3    terms   call     
na.action         4    exclude numeric  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Regression tree - Output</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(carb.mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"            "type"            "predicted"       "mse"            
 [5] "rsq"             "oob.times"       "importance"      "importanceSD"   
 [9] "localImportance" "proximity"       "ntree"           "mtry"           
[13] "forest"          "coefs"           "y"               "test"           
[17] "inbag"           "terms"           "na.action"      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> carb.mod<span class="sc">$</span>mse <span class="co"># Mean square error (of i-th element) </span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>rsq <span class="ot">&lt;-</span> carb.mod<span class="sc">$</span>rsq <span class="co"># Pseudo R-squared (1-mse/Var(y))(of i-th element)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6129997 5570019 5498393 5421758 5356727 5171813</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(mse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4128044 4129220 4130748 4130852 4130664 4130918</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(rsq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.07163319 -0.07193863 -0.07233534 -0.07236227 -0.07231334 -0.07237937</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Regression tree - Output</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the number of trees by the mse (Mean Square Error)</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>, mse, <span class="at">xlab=</span><span class="st">"Number of trees"</span>, <span class="at">ylab=</span><span class="st">"Mean Square Error rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: how many trees needed to stabilize prediction</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Similarly, plot the number of trees by the rsq (R-Squared)</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>, rsq, <span class="at">xlab=</span><span class="st">"Number of trees"</span>, <span class="at">ylab=</span><span class="st">"R-Squared"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Again: how many trees needed to stabilize prediction</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Variable importance – Classification tree</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Get importance table</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>asp.imp <span class="ot">&lt;-</span> <span class="fu">abs</span>(asp.mod<span class="sc">$</span>importance)</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>asp.imp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 0             1 MeanDecreaseAccuracy MeanDecreaseGini
TMb5   0.008492861 0.00106732947          0.006720638        21.870695
TMndvi 0.011361022 0.00090855490          0.008877476        19.303862
fnfrcl 0.002862576 0.00194577172          0.002638871         1.435293
elevm  0.001779809 0.00005164993          0.001533177        22.726870
slp    0.004208594 0.00629447891          0.001934033        15.954537
aspval 0.007676320 0.00664058231          0.007516978        12.314229</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Get the number of measures (columns) and number of predictors</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>ncols <span class="ot">&lt;-</span> <span class="fu">ncol</span>(asp.imp)  <span class="do">## Number of measures</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>numpred <span class="ot">&lt;-</span> <span class="fu">nrow</span>(asp.imp)<span class="do">## Get number of predictors</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the measures of variable importance for ASPEN presence/absence</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ncols){  <span class="do">## Loop thru the different importance measures</span></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>ivect <span class="ot">&lt;-</span> <span class="fu">sort</span>(asp.imp[,i], <span class="at">dec=</span><span class="cn">TRUE</span>)<span class="do">## Get 1st measure, descending order</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>iname <span class="ot">&lt;-</span> <span class="fu">colnames</span>(asp.imp)[i]   <span class="do">## Get name of measure</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate histogram plot (type='h') with no x axis (xaxt='n')</span></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ivect, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Measure"</span>, iname), <span class="at">xaxt=</span><span class="st">"n"</span>,</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Predictors"</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(ivect)))</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add x axis with associated labels</span></span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at=</span><span class="dv">1</span><span class="sc">:</span>numpred, <span class="at">lab=</span><span class="fu">names</span>(ivect)) </span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Let’s make a function and plot importance values for CARBON_KG model.</span></span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a>plotimp <span class="ot">&lt;-</span> <span class="cf">function</span>(itab){</span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a>ncols <span class="ot">&lt;-</span> <span class="fu">ncol</span>(itab) <span class="do">## Number of measures</span></span>
<span id="cb141-24"><a href="#cb141-24" aria-hidden="true" tabindex="-1"></a>numpred <span class="ot">&lt;-</span> <span class="fu">nrow</span>(itab)   <span class="do">## Get number of predictors</span></span>
<span id="cb141-25"><a href="#cb141-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-26"><a href="#cb141-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the measures of variable importance </span></span>
<span id="cb141-27"><a href="#cb141-27" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(ncols<span class="sc">/</span><span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb141-28"><a href="#cb141-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ncols){  <span class="do">## Loop thru the different importance measures</span></span>
<span id="cb141-29"><a href="#cb141-29" aria-hidden="true" tabindex="-1"></a>ivect <span class="ot">&lt;-</span> <span class="fu">sort</span>(itab[,i], <span class="at">dec=</span><span class="cn">TRUE</span>)   <span class="do">## Get 1st measure, sorted decreasing</span></span>
<span id="cb141-30"><a href="#cb141-30" aria-hidden="true" tabindex="-1"></a>iname <span class="ot">&lt;-</span> <span class="fu">colnames</span>(itab)[i]  <span class="do">## Get name of measure</span></span>
<span id="cb141-31"><a href="#cb141-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-32"><a href="#cb141-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate histogram plot (type='h') with no x axis (xaxt='n')</span></span>
<span id="cb141-33"><a href="#cb141-33" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ivect, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Measure"</span>, iname), <span class="at">xaxt=</span><span class="st">"n"</span>,</span>
<span id="cb141-34"><a href="#cb141-34" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Predictors"</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(ivect)))</span>
<span id="cb141-35"><a href="#cb141-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-36"><a href="#cb141-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Add x axis with associated labels</span></span>
<span id="cb141-37"><a href="#cb141-37" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at=</span><span class="dv">1</span><span class="sc">:</span>numpred, <span class="at">lab=</span><span class="fu">names</span>(ivect)) }</span>
<span id="cb141-38"><a href="#cb141-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb141-39"><a href="#cb141-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-40"><a href="#cb141-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Check function with ASPEN model</span></span>
<span id="cb141-41"><a href="#cb141-41" aria-hidden="true" tabindex="-1"></a><span class="fu">plotimp</span>(asp.imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Now, run funtion with CARBON_KG model</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotimp</span>(carb.mod<span class="sc">$</span>importance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dataanalytic-critique_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Other information from RandomForest model (proximity=TRUE)</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Measure of internal structure (Proximity measure)</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - The fraction of trees in which each plot falls in the same terminal node.</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - Similarity measure - in theory, similar data points will end up in the same terminal node.</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's try adding proximity to CARBON_KG model</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">66</span>)</span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>carb.mod <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(CARBON_KG <span class="sc">~</span> TMb5 <span class="sc">+</span> TMndvi <span class="sc">+</span> elevm <span class="sc">+</span> slp <span class="sc">+</span> aspval,  <span class="at">data=</span>modeldat, <span class="at">importance =</span> <span class="cn">TRUE</span>, <span class="at">proximity =</span> <span class="cn">TRUE</span>, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(carb.mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"            "type"            "predicted"       "mse"            
 [5] "rsq"             "oob.times"       "importance"      "importanceSD"   
 [9] "localImportance" "proximity"       "ntree"           "mtry"           
[13] "forest"          "coefs"           "y"               "test"           
[17] "inbag"           "terms"           "na.action"      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>carb.prox <span class="ot">&lt;-</span> carb.mod<span class="sc">$</span>proximity</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="co">#you can now explore carb.prox</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The final step in the analysis is to apply the model to the full dataset, in order to map the predicted outcomes.</p>
<section id="resources-this-week" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="resources-this-week"><span class="header-section-number">3.1.1</span> Resources this week</h3>
<ul>
<li><p><a href="http://r-statistics.co/Linear-Regression.html">Tutorial - Linear Regression</a></p></li>
<li><p><a href="https://finnstats.com/index.php/2022/03/13/predictive-analytics-models-in-r/">Predictive analytics post</a></p></li>
</ul>
</section>
</section>
<section id="parameterizationvalidation-iii" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="parameterizationvalidation-iii"><span class="header-section-number">3.2</span> Parameterization/Validation I/II</h2>
<p>Demo in class</p>
</section>
<section id="modelling-socio-technical-critique" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="modelling-socio-technical-critique"><span class="header-section-number">3.3</span> Modelling: Socio-Technical Critique</h2>
<section id="resources-this-week-1" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="resources-this-week-1"><span class="header-section-number">3.3.1</span> Resources this week</h3>
<ul>
<li><p><a href="https://link.springer.com/article/10.1007/s10109-020-00334-2">Brundson and Comber 2021</a></p></li>
<li><p><a href="https://www.sciencedirect.com/science/article/pii/S1364815218303773">Blair et al.&nbsp;2019</a><br>
</p></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./dataanalytic-visualization.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data/Analytic Visualization</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./data-to-decisions.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data to Decisions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>